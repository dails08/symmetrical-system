@if (this.cjs.roomType == "lobby"){
    <div class="unjoined">
        <app-join-screen></app-join-screen>
    </div>
}
<div class="playerSection">
    <p> <span class="playerDisplayName">{{this.cs.player.displayName}} </span> <span class="playerId">({{cs.player.id}})</span></p>
</div>
<div class="joined" *ngIf="this.cjs.roomType == 'gameplay'">
    @let slayer = cs.slayer;
    <div class="slayerDefined" *ngIf="slayer">
        <div class="topHalf">
            <div class="title">
                <p class="slayerClass">{{slayer.class}}</p>
                <p class="slayerName">{{slayer.name}}</p>
            </div>

            <div class="healthbar">
              <div class="barcontent">
              </div>
              <!-- <div class="gutters"> -->
                @for (_ of [].constructor(slayer.maxHP + 1);let ix = $index;  track $index){
                    <div  class="segment" [style.left]="'calc('+100*(ix)/slayer.maxHP+'%)'"></div>
                }
                  <!-- <div *ngFor="let _ of [].constructor(slayer.maxHP + 1); let ix = index" class="segment" [style.left]="'calc('+100*(ix)/slayer.maxHP+'%)'"></div> -->
                  <div class="segment halfhp" [style.left]="'calc(50% + 1px)'"></div>
              <!-- </div> -->
            </div>
            <div class="misc">
                <div class="speed stackedStat" [tp]="rollerPopover" [tpInteractive]="true" [tpData]="{name: 'Speed', size: slayer.speed}" tpVariation="popover" tpTrigger="click">
                    <p class="statName">Speed</p>
                    <p class="statNumber">d{{slayer.speed}}</p>
                </div>
                <div class="damage stackedStat">
                    <p class="statName">dmg</p>
                    <p class="statNumber">{{slayer.damage}}</p>
                </div>
                <div class="chekhov stackedStat">
                    <p class="statName">Chekhov</p>
                    <p class="statNumber">{{cs.player.chekhovPoints}}</p>
                </div>
            </div>
            <div class="skills">
                <!-- <div class="skillsLabel">
                    <p>Skills</p>
                </div> -->
                <ng-template #rollerPopover let-item="data">
                    <app-roller [name]="item.name" [size]="item.size"></app-roller>
                </ng-template>

                <div class="skill" [tp]="rollerPopover" [tpInteractive]="true" [tpData]="{name: 'Agile', size: slayer.skillsAgile}" tpTrigger="click">
                    <img src="/assets/shapes/{{slayer.skillsAgile}}.svg">
                    <p class="skillName agile">Agile</p>
                </div>
                <div class="skill" [tp]="rollerPopover" [tpInteractive]="true" [tpData]="{name: 'Brawn', size: slayer.skillsBrawn}" tpVariation="popover" tpTrigger="click">
                     <img src="/assets/shapes/{{slayer.skillsBrawn}}.svg">
                    <p class="skillName">Brawn</p>
                </div>
                <div class="skill" [tp]="rollerPopover" [tpInteractive]="true" [tpData]="{name: 'Deceive', size: slayer.skillsDeceive}" tpVariation="popover" tpTrigger="click">
                    <img src="/assets/shapes/{{slayer.skillsDeceive}}.svg">
                    <p class="skillName deceive">Deceive</p>
                </div>
                <div class="skill" [tp]="rollerPopover" [tpInteractive]="true" [tpData]="{name: 'Hunt', size: slayer.skillsHunt}" tpVariation="popover" tpTrigger="click">
                    <img src="/assets/shapes/{{slayer.skillsHunt}}.svg">
                    <p class="skillName hunt">Hunt</p>
                </div>
                <div class="skill" [tp]="rollerPopover" [tpInteractive]="true" [tpData]="{name: 'Mend', size: slayer.skillsMend}" tpVariation="popover" tpTrigger="click">
                    <img src="/assets/shapes/{{slayer.skillsMend}}.svg">
                    <p class="skillName">Mend</p>
                </div>
                <div class="skill" [tp]="rollerPopover" [tpInteractive]="true" [tpData]="{name: 'Negotiate', size: slayer.skillsNegotiate}" tpVariation="popover" tpTrigger="click">
                    <img src="/assets/shapes/{{slayer.skillsNegotiate}}.svg">
                    <p class="skillName negotiate">Negotiate</p>
                </div>
                <div class="skill" [tp]="rollerPopover" [tpInteractive]="true" [tpData]="{name: 'Stealth', size: slayer.skillsStealth}" tpVariation="popover" tpTrigger="click">
                    <img src="/assets/shapes/{{slayer.skillsStealth}}.svg">
                    <p class="skillName">Stealth</p>
                </div>
                <div class="skill" [tp]="rollerPopover" [tpInteractive]="true" [tpData]="{name: 'Street', size: slayer.skillsStreet}" tpVariation="popover" tpTrigger="click">
                    <img src="/assets/shapes/{{slayer.skillsStreet}}.svg">
                    <p class="skillName">Street</p>
                </div>
                <div class="skill" [tp]="rollerPopover" [tpInteractive]="true" [tpData]="{name: 'Study', size: slayer.skillsStudy}" tpVariation="popover" tpTrigger="click">
                    <img src="/assets/shapes/{{slayer.skillsStudy}}.svg">
                    <p class="skillName">Study</p>
                </div>
                <div class="skill" [tp]="rollerPopover" [tpInteractive]="true" [tpData]="{name: 'Tactics', size: slayer.skillsTactics}" tpVariation="popover" tpTrigger="click">
                    <img src="/assets/shapes/{{slayer.skillsTactics}}.svg">
                    <p class="skillName">Tactics</p>
                </div>
                <!-- <div class="skill">Brawn: {{slayer.skillsBrawn}} </div>
                <div class="skill">Deceive: {{slayer.skillsDeceive}} </div>
                <div class="skill">Hunt: {{slayer.skillsHunt}} </div>
                <div class="skill">Mend: {{slayer.skillsMend}} </div>
                <div class="skill">Negotiate: {{slayer.skillsNegotiate}} </div>
                <div class="skill">Street: {{slayer.skillsStreet}} </div>
                <div class="skill">Stealth: {{slayer.skillsStealth}} </div>
                <div class="skill">Study: {{slayer.skillsStudy}} </div>
                <div class="skill">Tactics: {{slayer.skillsTactics}} </div> -->
            </div>


            <div class="advances">
              <p class="rowLabel">advances</p>
                @for (advance of slayer.advances.toArray(); track advance.name + ":" + $index){
                    <div class="advance">
                        <ng-template class="advancePopover" #advancePopover>{{advance.desc}}</ng-template>
                        <p [tp]="advancePopover" tpVariation="popover" tpTrigger="click" class="advanceName">{{advance.name}}</p>
                    </div>
                }
            </div>
              <div class="advances" >
                  <p class="rowLabel">inventory</p>

                  @for (invItem of slayer.inventory.toArray(); track invItem.name){
                      <div class="advance">
                          <ng-template class="advancePopover" #advancePopover>{{invItem.desc}}</ng-template>
                          <p [tp]="advancePopover" tpVariation="popover" tpTrigger="click" class="advanceName">{{invItem.name}}</p>
                      </div>
                  }
              </div>

        </div>
        <div class="bottomHalf">
            @if (slayer.class == playbooks.Blade){
                <app-char-sheet-blade [slayer]="slayer | asBlade"></app-char-sheet-blade>
            }

            @if (slayer.class == playbooks.Gunslinger){
                <app-char-sheet-gunslinger [slayer]="slayer | asGunslinger"></app-char-sheet-gunslinger>
            }
            <div class="arcanistData" *ngIf="slayer.class == playbooks.Arcanist">
                @let castSlayer = slayer | asArcanist;
                <div class="stance">
                    <p>Corruption: {{castSlayer.corruption}}</p>
                </div>
                <div class="favoredSpell">
                    <p>Favored Spell: {{castSlayer.favoredSpell}}</p>
                </div>
                <div class="knownSpells">
                    <p *ngFor="let knownSpell of castSlayer.knownSpells">{{knownSpell | json}}</p>
                </div>
            </div>
              <!-- @let castSlayer = slayer | asTactician; -->
               @if (slayer.class == playbooks.Tactician){
                <app-char-sheet-tactician  [slayer]="slayer | asTactician"></app-char-sheet-tactician>

               }
        </div>
    </div>
    <div class="slayerUndefined" *ngIf="!cs.slayer">
        <p>No Slayer assigned</p>
    </div>
</div>

<!-- <div class="FAB" (click)="null">+</div> -->
